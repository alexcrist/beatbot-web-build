(this.webpackJsonp=this.webpackJsonp||[]).push([[4],{638:function(e,t,n){"use strict";n.r(t);var i,a,r,o,c,s,l,u,b,d,f,p,h,j,x,m,g,O,w,v,y,D,V,k,S,A,I,T,P,R,L,M,E,z,H,N,G,C,Z,K,U,B,F,W=n(11),q=n.n(W),J=n(25),Y=n(12),Q=n(1),X=n(9),$=n.n(X),_=n(0),ee=n(185),te=n(54),ne=n(187),ie=n(109),ae=n(188),re=n(18),oe=n(63),ce=n(2),se=Y.a.View(i||(i=q()(["\n  position: absolute;\n  top: ","px;\n  bottom: 0;\n  width: 4px;\n  border-radius: 2px;\n  background-color: ",";\n  z-index: 1;\n  opacity: ",";\n"])),Q.ab+Q.Z,Q.k.DARK,(function(e){return e.isVisible?1:0})),le=re.a.createAnimatedComponent(se),ue=function(e){var t=e.isInputPlaying,n=e.isOutputPlaying,i=e.inputDuration,a=Object(_.useState)(null),r=$()(a,2),o=r[0],c=r[1],s=Object(_.useRef)(new re.a.Value(0)).current,l=s?s.interpolate({inputRange:[0,1],outputRange:["0%","100%"]}):"0%";return Object(_.useEffect)((function(){t||n?function(){var e=i,t=re.a.loop(re.a.sequence([re.a.timing(s,{toValue:0,duration:0,useNativeDriver:Q.a}),re.a.timing(s,{toValue:1,duration:1e3*e,useNativeDriver:Q.a,easing:oe.a.linear})]));t.start(),c(t)}():o&&o.stop()}),[t,n]),Object(ce.jsx)(le,{isVisible:t||n,style:{left:l}})},be=Y.a.View(a||(a=q()(["\n  position: relative;\n  width: 100%;\n  margin-vertical: ","px;\n  flex: 1;\n  max-height: 280px;\n"])),Q.bb),de=Y.a.View(r||(r=q()(["\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  padding-horizontal: ","px;\n  margin-bottom: ","px;\n"])),Q.Z,Q.Z),fe=Y.a.Text(o||(o=q()(["\n  font-family: ",";\n  font-size: ","px;\n  line-height: ","px;\n  color: ",";\n"])),Q.v,Q.ab,Q.ab,Q.k.DARK),pe=Y.a.View(c||(c=q()(["\n  flex: 1;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n"]))),he=Y.a.View(s||(s=q()(["\n  flex: 1;\n  align-items: center;\n  justify-content: space-around;\n  flex-direction: row;\n  width: ","px;\n"])),(function(e){return e.width})),je=Y.a.View(l||(l=q()(["\n  width: ","px;\n  min-height: ","px;\n  border-radius: ","px;\n  background-color: ",";\n  height: ","px;\n"])),Q.c,2*Q.c,Q.c/2,(function(e){return e.color}),(function(e){return e.height})),xe=function(e,t,n){for(var i=Math.floor(n/t*(e.length-1)),a=Math.floor((n+1)/t*(e.length-1)),r=0,o=i;o<=a;o++)r+=e[o];return r},me=function(e,t,n,i,a,r){var o=a%Q.k.HIGHLIGHTS.length,c=Q.k.HIGHLIGHTS[o],s=Math.ceil(t/(r.length-1)*(i-1)),l=Math.floor(n/(r.length-1)*(i-1));l=Math.max(l,s);for(var u=s;u<=l;u++)e[u]=c},ge=function(e){for(var t=e.volume,n=e.inputDuration,i=e.beatStarts,a=e.beatEnds,r=e.classifications,o=e.isInputPlaying,c=e.isOutputPlaying,s=[],l=0;l<4;l++){var u=Math.round(n/3*l);s.push(Object(ce.jsx)(fe,{children:Object(ae.b)(u)},"timestamp-"+l))}var b=Object(_.useState)(null),d=$()(b,2),f=d[0],p=d[1],h=Object(_.useMemo)((function(){if(!f)return null;for(var e=Math.floor((f.width-Q.b)/(Q.c+Q.b)),n=e*Q.c+(e+1)*Q.b,o=[],c=-1/0,s=1/0,l=0;l<e;l++){var u=xe(t,e,l);c=Math.max(c,u),s=Math.min(s,u),o.push(u)}for(var b=[],d=0;d<e;d++)b.push(Q.k.LIGHT);for(var p=0;p<i.length;p++)me(b,i[p],a[p],e,r[p],t);for(var h=[],j=0;j<e;j++){var x=(o[j]-s)/(c-s)*f.height;h.push(Object(ce.jsx)(je,{height:x,color:b[j]},"line-"+j))}return Object(ce.jsx)(he,{width:n,children:h})}),[f,t,i,a,r]);return Object(ce.jsxs)(be,{children:[Object(ce.jsx)(ue,{inputDuration:n,isInputPlaying:o,isOutputPlaying:c}),Object(ce.jsx)(de,{children:s}),Object(ce.jsx)(pe,{onLayout:function(e){var t=e.nativeEvent.layout,n=t.width,i=t.height;p({width:n,height:i})},children:h})]})},Oe=n(446),we=Y.a.View(u||(u=q()(["\n  width: 100%;\n  overflow: hidden;\n  position: relative;\n"]))),ve=Y.a.View(b||(b=q()(["\n  width: ","%;\n  flex-direction: row;\n"])),(function(e){return 100*e.numbersLength})),ye=re.a.createAnimatedComponent(ve),De=Y.a.View(d||(d=q()(["\n  width: ","%;\n"])),(function(e){return 100/e.numbersLength})),Ve=Y.a.Text(f||(f=q()(["\n  font-family: ",";\n  font-size: ","px;\n  line-height: ","px;\n  color: ",";\n  text-align: center;\n"])),Q.gb,Q.hb,Q.hb,Q.k.DARK),ke=Y.a.Text(p||(p=q()(["\n  font-family: ",";\n  font-size: ","px;\n  color: ",";\n  text-align: center;\n"])),Q.v,Q.ab,Q.k.DARK),Se=Y.a.TouchableOpacity(h||(h=q()(["\n  position: absolute;\n  left: 0;\n  top: 2px;\n  padding-left: ","px;\n"])),Q.bb),Ae=Y.a.TouchableOpacity(j||(j=q()(["\n  position: absolute;\n  right: 0;\n  top: 2px;\n  padding-right: ","px;\n"])),Q.bb),Ie="0%",Te=function(e){for(var t=e.label,n=e.numbers,i=e.confidences,a=e.selectNumber,r=e.selectedNumber,o=e.style,c=0,s=0;s<n.length;s++)n[s]===r&&(c=s);var l=Object(_.useRef)(new re.a.Value(0)).current;l&&(Ie=l.interpolate({inputRange:[0,n.length-1],outputRange:["0%","-"+100*(n.length-1)+"%"]})),Object(_.useEffect)((function(){var e;e=c,re.a.timing(l,{toValue:e,duration:350,useNativeDriver:Q.a}).start()}),[r]);return Object(ce.jsxs)(we,{style:o,children:[Object(ce.jsx)(ye,{numbersLength:n.length,style:{marginLeft:Ie},children:n.map((function(e,a){return Object(ce.jsxs)(De,{numbersLength:n.length,children:[Object(ce.jsxs)(Ve,{children:[e," ",t]}),Object(ce.jsxs)(ke,{children:[i[a],"% confidence"]})]},"slide-"+a+"-"+e)}))}),0===c?null:Object(ce.jsx)(Se,{onPress:function(){a(n[c-1])},children:Object(ce.jsx)(Oe.a,{name:"chevron-circle-left",size:Q.l,color:Q.k.DARK,solid:!0})}),c===n.length-1?null:Object(ce.jsx)(Ae,{onPress:function(){a(n[c+1])},children:Object(ce.jsx)(Oe.a,{name:"chevron-circle-right",size:Q.l,color:Q.k.DARK,solid:!0})})]})},Pe=n(55),Re=n(111),Le=Y.a.View(x||(x=q()(["\n  flex-direction: row;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: center;\n  margin-horizontal: ","px;\n"])),Q.Z/2),Me=Y.a.View(m||(m=q()(["\n  width: 200px;\n  max-width: 40%;\n  margin-horizontal: ","px;\n  margin-bottom: ","px;\n"])),Q.Z/2,Q.Z),Ee=Y.a.View(g||(g=q()(["\n  width: 100%;\n  height: ","px;\n  border-radius: ","px;\n  background-color: ",";\n  justify-content: center;\n  align-items: center;\n"])),Q.o,Q.o/2,(function(e){return e.color})),ze=Y.a.Text(O||(O=q()(["\n  font-size: ","px;\n  font-family: ",";\n  color: ",";\n"])),Q.Y,Q.w,Q.k.BACKGROUND),He=function(e){for(var t=e.classifications,n=e.drumMap,i=e.style,a=e.showModal,r=e.setSelectedClassification,o=[],c=0;c<t.length;c++)o.includes(t[c])||o.push(t[c]);var s=o.map((function(e){var t=e%n.length;return n[t]})).map(Re.c);return Object(ce.jsx)(Le,{style:i,children:s.map((function(e,t){var n=o[t]%Q.k.HIGHLIGHTS.length,i=Q.k.HIGHLIGHTS[n];return Object(ce.jsx)(Me,{children:Object(ce.jsx)(Pe.a,{onPress:function(){r(o[t]),a()},children:Object(ce.jsx)(Ee,{color:i,children:Object(ce.jsx)(ze,{children:e.name.toLowerCase()})})})},"drum-"+t)}))})},Ne=n(19),Ge=n.n(Ne),Ce=n(56),Ze=function(e,t,n){return(e+1)*(t/n)},Ke=Y.a.View(w||(w=q()(["\n  align-items: flex-start;\n"]))),Ue=Y.a.TouchableOpacity(v||(v=q()(["\n  flex-direction: row;\n  align-items: center;\n  margin-bottom: ","px;\n  margin-top: ","px;\n"])),Q.Z/2,Q.bb/2),Be=Y.a.Text(y||(y=q()(["\n  font-family: ",";\n  font-size: ","px;\n  color: ",";\n  margin-left: ","px;\n"])),Q.gb,Q.z,Q.k.DARK,Q.bb),Fe=Y.a.TouchableOpacity(D||(D=q()(["\n  margin-bottom: ","px;\n  margin-top: ","px;\n  margin-left: ","px;\n  background-color: ",";\n  border-radius: \n  height: 30px;\n  border-radius: 15px;\n  justify-content: center;\n"])),Q.Z/2,Q.Z/2,28+Q.Z,(function(e){return e.isSelected?e.color:"#00000000"})),We=Y.a.Text(V||(V=q()(["\n  font-family: ",";\n  font-size: ","px;\n  color: ","\n  padding-horizontal: ","px;\n"])),Q.w,Q.ab,(function(e){return e.isSelected?Q.k.BACKGROUND:Q.k.DARK}),Q.Z),qe=function(e){for(var t=e.drumSoundFolder,n=e.selectedDrumId,i=e.setSelectedDrumId,a=e.color,r=!1,o=0;o<t.children.length;o++)t.children[o].id===n&&(r=!0);var c=Object(_.useState)(r),s=$()(c,2),l=s[0],u=s[1];return Object(ce.jsxs)(Ke,{children:[Object(ce.jsxs)(Ue,{onPress:function(){u(!l)},children:[Object(ce.jsx)(Oe.a,{color:Q.k.DARK,name:l?"chevron-down":"chevron-right",size:20,solid:!0}),Object(ce.jsx)(Be,{children:t.name.toLowerCase()})]}),l?t.children.map((function(e){var t=e.id===n;return Object(ce.jsx)(Fe,{isSelected:t,color:a,onPress:function(){e.sound.play(),i(e.id)},children:Object(ce.jsx)(We,{isSelected:t,children:e.name.toLowerCase()})},e.id)})):null]})},Je=Object(Y.a)(Ce.a)(k||(k=q()(["\n  flex: 1;\n  padding: ","px;\n"])),Q.bb),Ye=Y.a.View(S||(S=q()(["\n  margin-bottom: ","px;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n"])),Q.Z),Qe=Y.a.Text(A||(A=q()(["\n  font-family: ",";\n  font-size: ","px;\n  color: ",";\n"])),Q.gb,Q.hb,Q.k.DARK),Xe=Y.a.TouchableOpacity(I||(I=q()(["\n  height: 30px;\n  border-radius: 15px;\n  border: ","px solid ",";\n  flex-direction: row;\n  justify-content: space-around; \n  align-items: center;\n  padding-horizontal: ","px;\n"])),Q.g,Q.k.DARK,Q.Z),$e=Y.a.Text(T||(T=q()(["\n  font-family: ",";\n  font-size: ","px;\n  line-height: ","px;\n  margin-top: 3px;\n  color: ",";\n  margin-left: ","px;\n"])),Q.w,Q.ab,Q.ab,Q.k.DARK,Q.Z),_e=Y.a.ScrollView(P||(P=q()(["\n"]))),et=Y.a.View(R||(R=q()(["\n  flex-direction: row;\n  margin-top: ","px;\n"])),Q.Z),tt=Object(Y.a)(te.a)(L||(L=q()(["\n  flex: 1;\n"]))),nt=function(e){for(var t=e.isVisible,n=e.setIsVisible,i=e.classification,a=e.drumMap,r=e.classifications,o=e.beatStarts,c=e.beatEnds,s=e.inputAudio,l=i%Q.k.HIGHLIGHTS.length,u=Q.k.HIGHLIGHTS[l],b=i%a.length,d=a[b],f=function(e){var t=Ge()(a);t[b]=e,Object(ie.setSelectedDrumMap)(t)},p=0,h=0;h<r.length;h++)r[h]===i&&(p=h);var j=Ze(o[p],Q.f,Q.e),x=Ze(c[p],Q.f,Q.e),m=s.data.slice(j,x),g=Object(ee.a)(new Int16Array(m),s.rate,s.channels);return Object(ce.jsxs)(Je,{isVisible:t,close:function(){return n(!1)},children:[Object(ce.jsxs)(Ye,{children:[Object(ce.jsx)(Qe,{children:"Instrument"}),Object(ce.jsxs)(Xe,{onPress:function(){g.play()},children:[Object(ce.jsx)(Oe.a,{size:14,name:"volume-up",color:Q.k.DARK,solid:!0}),Object(ce.jsx)($e,{children:"input"})]})]}),Object(ce.jsx)(_e,{contentContainerStyle:{flex:1},children:Re.b.map((function(e,t){return Object(ce.jsx)(qe,{drumSoundFolder:e,color:u,selectedDrumId:d,setSelectedDrumId:f},"drum-sound-folder-"+t)}))}),Object(ce.jsx)(et,{children:Object(ce.jsx)(tt,{text:"Done",onPress:function(){n(!1)}})})]})},it=n(225),at=n(224),rt=n(630),ot=n.n(rt),ct=function(e,t,n,i,a){var r=Ze(e,n,i),o=st(r,t);return lt(o,a)},st=function(e,t){return e/t*1e3},lt=function(e,t){var n=Math.round(6e7/t),i=e/1e3;return Math.round(i/(1e-6*n/128))},ut=n(226),bt=function(e,t){var n,i=t===Q.t.MIDI,a=t===Q.t.WAV;if(!i&&!a)throw Error("Invalid export file type.");if(a){var r=e.beatbotData.outputAudio,o=r.data,c=r.rate,s=r.channels,l=new Int16Array(o);n=Object(ut.a)(l,c,s)}else if(i){var u=e.beatbotData;n=function(e,t,n,i){var a=new ot.a.Track;a.setTempo(Q.G);for(var r=0;r<e.length;r++){var o=e[r],c=t[r],s=n[r],l=ct(o,i,Q.f,Q.e,Q.G),u=ct(c,i,Q.f,Q.e,Q.G)-l,b=s+Q.H,d=new ot.a.NoteEvent({startTick:l,pitch:b,duration:"T"+u});a.addEvent(d)}return new ot.a.Writer([a]).buildFile().buffer}(u.beatStarts,u.beatEnds,u.classifications,u.outputAudio.rate)}var b=a?".wav":".mid";!function(e,t){var n=new Blob([e],{type:"octet/stream"}),i=window.URL.createObjectURL(n),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(i)}(n,e.name+b)},dt=function(e){var t=e.isVisible,n=e.setIsVisible,i=Object(J.c)(ne.a);return Object(ce.jsx)(at.a,{isVisible:t,setIsVisible:n,options:[{text:"Export midi data (.mid)",onPress:function(){bt(i,Q.t.MIDI)}},{text:"Export audio (.wav)",onPress:function(){bt(i,Q.t.WAV)}}]})},ft=n(28),pt=Y.a.View(M||(M=q()(["\n  flex: 1;\n  align-items: center;\n"]))),ht=Y.a.View(E||(E=q()(["\n  align-items: center;\n  flex: 1;\n  width: 100%;\n"]))),jt=Y.a.View(z||(z=q()(["\n  align-items: center;\n  width: 100%;\n"]))),xt=Y.a.View(H||(H=q()(["\n  margin-top: ","px;\n  width: 100%;\n  max-width: 1000px;\n"])),Q.bb),mt=Y.a.View(N||(N=q()(["\n  align-items: center;\n  width: 100%;\n  max-width: 500px;\n  padding: ","px;\n"])),Q.bb),gt=Y.a.View(G||(G=q()(["\n  flex-direction: row;\n  justify-content: center;\n  margin-bottom: ","px;\n  margin-horizontal: ","px;\n  width: 100%;\n"])),Q.Z,Q.bb),Ot=Object(Y.a)(te.b)(C||(C=q()(["\n  margin-right: ","px;\n  flex: 1;\n"])),Q.Z/2),wt=Object(Y.a)(te.a)(Z||(Z=q()(["\n  margin-left: ","px;\n  flex: 1;\n"])),Q.Z/2),vt=function(){var e=Object(J.c)((function(e){return Object(ne.a)(e)})),t=Object(ft.p)();Object(_.useEffect)((function(){t.setOptions({title:e.name,headerLeft:it.a})}),[e,t]);var n=Object(J.c)((function(e){return Object(ne.a)(e).inputAudio})),i=Object(J.c)((function(e){return Object(ne.a)(e).beatbotData.outputAudio}));Object(_.useEffect)((function(){if(K&&K.load(),n){var e=n.data,t=n.rate,i=n.channels;K=Object(ee.a)(e,t,i)}}),[n]),Object(_.useEffect)((function(){if(U&&U.load(),i){var e=i.data,t=i.rate,n=i.channels;U=Object(ee.a)(e,t,n)}}),[i]);var a=Object(_.useState)(!1),r=$()(a,2),o=r[0],c=r[1],s=Object(_.useState)(-1),l=$()(s,2),u=l[0],b=l[1],d=Object(_.useState)(!1),f=$()(d,2),p=f[0],h=f[1],j=Object(_.useState)(!1),x=$()(j,2),m=x[0],g=x[1],O=Object(_.useState)(null),w=$()(O,2),v=w[0],y=w[1],D=Object(_.useState)(null),V=$()(D,2),k=V[0],S=V[1],A=function(){K.load(),clearTimeout(v),h(!1)},I=function(){U.load(),clearTimeout(k),g(!1)},T=Object(_.useState)(!1),P=$()(T,2),R=P[0],L=P[1];return Object(_.useEffect)((function(){return function(){A(),I()}}),[]),Object(ce.jsxs)(pt,{children:[Object(ce.jsxs)(ht,{children:[Object(ce.jsx)(ge,{volume:e.beatbotData.volume,inputDuration:e.inputAudio.duration,beatStarts:e.beatbotData.beatStarts,beatEnds:e.beatbotData.beatEnds,classifications:e.beatbotData.classifications,isInputPlaying:p,isOutputPlaying:m}),Object(ce.jsx)(He,{classifications:e.beatbotData.classifications,drumMap:e.drumMap,showModal:function(){return c(!0)},setSelectedClassification:b}),Object(ce.jsx)(xt,{children:Object(ce.jsx)(Te,{label:"total beats",numbers:e.beatbotData.likelyNumPeaks.slice(0,Q.s),confidences:e.beatbotData.numPeaksLikelihoods.slice(0,Q.s),selectNumber:ie.setSelectedNumPeaks,selectedNumber:e.beatbotData.chosenNumPeaks})}),Object(ce.jsx)(xt,{children:Object(ce.jsx)(Te,{label:"unique sounds",numbers:e.beatbotData.likelyNumClusters.slice(0,Q.r),confidences:e.beatbotData.numClustersLikelihoods.slice(0,Q.r),selectNumber:ie.setSelectedNumClusters,selectedNumber:e.beatbotData.chosenNumClusters})})]}),Object(ce.jsx)(jt,{children:Object(ce.jsxs)(mt,{children:[Object(ce.jsxs)(gt,{children:[Object(ce.jsx)(Ot,{onPress:function(){p?A():(I(),K.onplay=function(){var t=setTimeout((function(){return h(!1)}),1e3*e.inputAudio.duration);y(t),h(!0)},K.play())},text:p?"Stop input":"Play input",icon:p?"stop":"play"}),Object(ce.jsx)(wt,{onPress:function(){m?I():(A(),U.onplay=function(){var t=setTimeout((function(){return g(!1)}),1e3*e.inputAudio.duration);S(t),g(!0)},U.play())},text:m?"Stop":"Play",icon:m?"stop":"play"})]}),Object(ce.jsx)(te.b,{text:"Export...",onPress:function(){L(!0)}})]})}),Object(ce.jsx)(nt,{isVisible:o,setIsVisible:c,classification:u,classifications:e.beatbotData.classifications,drumMap:e.drumMap,beatStarts:e.beatbotData.beatStarts,beatEnds:e.beatbotData.beatEnds,inputAudio:e.inputAudio}),Object(ce.jsx)(dt,{isVisible:R,setIsVisible:L})]})},yt=n(122),Dt=(n(75),Y.a.View(B||(B=q()(["\n  flex: 1;\n  width: 100%;\n  overflow: hidden;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: ","px;\n"])),2*Q.bb)),Vt=function(){var e=Object(ft.p)();return Object(_.useEffect)((function(){e.setOptions({title:"Loading...",headerLeft:null})}),[e]),Object(ce.jsx)(Dt,{children:Object(ce.jsx)(yt.a,{lineColors:Q.N})})},kt=Y.a.View(F||(F=q()(["\n  flex: 1;\n  background-color: ",";\n"])),Q.k.BACKGROUND);t.default=function(e){var t=e.navigation,n=Object(J.c)((function(e){return e.recordings.isProcessing}))?Object(ce.jsx)(Vt,{navigation:t}):Object(ce.jsx)(vt,{navigation:t});return Object(ce.jsx)(kt,{children:n})}}}]);
//# sourceMappingURL=4.0ea6a588.chunk.js.map